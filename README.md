# Excel批量处理工具

## 项目简介

这是一个基于Python开发的Excel批量处理工具，采用MVC架构设计，具有直观的图形用户界面。工具可以从指定位置读取Excel文件中的数据，并将其填充到预定义的模板中生成新的Excel文件。

## 主要功能

- ✅ **批量处理**: 支持选择文件夹批量处理多个Excel文件
- ✅ **数据提取**: 从固定位置（可配置）提取Excel中的数据
- ✅ **模板填充**: 将提取的数据填充到预定义模板的指定位置
- ✅ **进度显示**: 实时显示处理进度和详细日志
- ✅ **错误处理**: 完善的错误处理和用户友好的提示信息
- ✅ **可配置**: 通过配置文件灵活调整数据提取和填充规则
- ✅ **多线程**: 支持多线程并行处理，提高处理效率

## 项目架构

```
excel_processor/
├── main.py                 # 主程序入口
├── config/
│   ├── __init__.py
│   └── settings.py         # 配置文件
├── models/
│   ├── __init__.py
│   ├── excel_reader.py     # Excel读取模型
│   └── excel_writer.py     # Excel写入模型
├── views/
│   ├── __init__.py
│   └── main_window.py      # 主窗口UI
├── controllers/
│   ├── __init__.py
│   └── processor.py        # 业务逻辑控制器
├── templates/
│   └── template.xlsx       # 用户提供的模板文件
├── requirements.txt        # 依赖包列表
├── build_exe.py           # 打包脚本
└── README.md              # 本文档
```

## 安装说明

### 环境要求

- Python 3.7 或更高版本
- Windows / macOS / Linux

### 依赖安装

1. 克隆或下载项目到本地
2. 安装Python依赖包：

```bash
pip install -r requirements.txt
```

主要依赖包：
- `openpyxl`: Excel文件读写
- `PyInstaller`: 打包可执行文件

## 使用方法

### 准备模板文件

**重要**: 在使用工具之前，您需要将Excel模板文件放入 `templates/` 目录下，并命名为 `template.xlsx`。

模板文件应该包含：
- 预定义的表头（可选）
- 数据填充的目标位置

如果您没有模板文件，可以：
1. 启动程序后点击"创建模板"按钮自动生成一个基础模板
2. 根据配置文件中的设置手动创建模板

### 直接运行Python脚本

```bash
python main.py
```

### 使用界面操作

1. **准备模板**: 确保 `templates/template.xlsx` 文件存在
2. **启动程序**: 运行main.py或双击可执行文件
3. **选择源文件夹**: 点击"浏览"按钮选择包含待处理Excel文件的文件夹
4. **选择输出文件夹**: 点击"浏览"按钮选择处理结果的输出位置
5. **查看文件信息**: 程序会自动扫描并显示找到的Excel文件数量
6. **开始处理**: 点击"开始处理"按钮启动批量处理
7. **监控进度**: 通过进度条和日志窗口监控处理状态
8. **查看结果**: 处理完成后在输出文件夹中查看生成的文件

### 配置自定义

编辑 `config/settings.py` 文件可以自定义：

- **数据提取位置**: 修改 `SOURCE_CONFIG` 中的 `start_row`, `start_col` 和 `fields` 配置
- **模板填充位置**: 修改 `TARGET_CONFIG` 中的 `fill_positions` 配置
- **输出文件格式**: 修改 `OUTPUT_CONFIG` 中的命名规则
- **UI界面设置**: 修改 `UI_CONFIG` 中的界面配置

#### 示例配置

```python
# 源数据配置 - 从第2行第1列开始读取
SOURCE_CONFIG = {
    'start_row': 2,
    'start_col': 1,
    'fields': {
        'name': 1,      # A列 - 姓名
        'age': 2,       # B列 - 年龄  
        'department': 3, # C列 - 部门
        'salary': 4,    # D列 - 薪资
        'email': 5,     # E列 - 邮箱
    }
}

# 模板填充配置 - 数据填充到模板的位置
TARGET_CONFIG = {
    'fill_positions': {
        'name': (2, 1),      # 填充到第2行第1列
        'age': (2, 2),       # 填充到第2行第2列
        'department': (2, 3), # 填充到第2行第3列
        'salary': (2, 4),    # 填充到第2行第4列
        'email': (2, 5),     # 填充到第2行第5列
    }
}
```

### 模板文件格式

您的模板文件应该遵循以下格式：

1. **表头行**（可选）：通常在第1行设置列标题
2. **数据行**：从第2行开始，按照配置文件中的位置映射填充数据
3. **格式设置**：可以预先设置单元格格式、字体、颜色等

#### 模板示例

| A列(姓名) | B列(年龄) | C列(部门) | D列(薪资) | E列(邮箱) |
|----------|----------|----------|----------|----------|
| 张三      | 25       | 技术部    | 8000     | zhang@example.com |

## 打包为可执行文件

项目包含打包脚本，可以将Python程序打包为独立的可执行文件：

```bash
python build_exe.py
```

打包完成后，可执行文件位于 `dist/` 目录中。

**注意**: 打包后的可执行文件仍然需要templates目录和模板文件才能正常工作。

### 打包选项

- **单文件模式**: 打包为单个exe文件，便于分发
- **无控制台**: Windows下运行时不显示控制台窗口
- **包含依赖**: 自动包含所有必要的Python库和依赖

## 技术特性

### MVC架构

- **Model层**: `models/` - 负责数据处理逻辑
  - `ExcelReader`: Excel文件读取和数据提取
  - `ExcelWriter`: 模板填充和文件生成
  
- **View层**: `views/` - 负责用户界面
  - `MainWindow`: 主窗口界面和用户交互
  
- **Controller层**: `controllers/` - 负责业务逻辑
  - `ProcessorController`: 协调读取和写入操作，管理批量处理流程

### 核心功能

- **多线程处理**: 使用线程池并行处理多个文件，提高效率
- **实时进度**: 通过回调函数实时更新处理进度和状态
- **错误处理**: 完善的异常处理，确保程序稳定运行
- **日志系统**: 详细的日志记录，便于问题排查
- **配置化**: 通过配置文件轻松调整处理规则

## 文件格式支持

- **输入格式**: `.xlsx`, `.xls`
- **输出格式**: `.xlsx`

## 故障排除

### 常见问题

1. **模板文件不存在**
   - 解决方案: 将您的Excel模板文件放入templates目录并命名为template.xlsx，或点击"创建模板"按钮生成基础模板

2. **文件权限错误**
   - 解决方案: 确保对源文件夹有读取权限，对输出文件夹有写入权限

3. **Excel文件损坏**
   - 解决方案: 检查源Excel文件是否能正常打开，替换损坏的文件

4. **内存不足**
   - 解决方案: 减少并发线程数或分批处理大量文件

5. **数据位置不匹配**
   - 解决方案: 检查配置文件中的SOURCE_CONFIG和TARGET_CONFIG设置是否与实际文件格式匹配

### 调试模式

修改 `config/settings.py` 中的日志级别可以获取更详细的调试信息：

```python
LOG_CONFIG = {
    'level': 'DEBUG',  # 改为DEBUG获取详细日志
    # ...
}
```

## 版本信息

- **当前版本**: 1.0.0
- **Python版本**: 3.7+
- **最后更新**: 2024年

## 许可证

本项目基于MIT许可证开源。

## 技术支持

如有问题或建议，请通过以下方式联系：

- 提交Issue到项目仓库
- 查看项目文档和日志文件
- 检查配置文件设置

## 更新日志

### v1.0.0 (2024)
- 初始版本发布
- 实现基本的Excel批量处理功能
- 提供图形用户界面
- 支持打包为可执行文件
- 完整的MVC架构设计
- 用户手动提供模板文件，支持自定义模板格式 